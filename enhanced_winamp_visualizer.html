<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Enhanced Winamp-Style Spectrum</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Back to 2D Button -->
  <button id="back-to-2d" class="back-to-2d">
    ‚Üê Back to 2D
  </button>

  <header>
    <h1>Enhanced Winamp Spectrum</h1>
    <label class="file btn">
      Load audio
      <input id="file" type="file" accept="audio/*" multiple />
    </label>
    <button id="url" class="btn">Load URL</button>
    <button id="mic" class="btn">Use mic</button>
    <button id="play" class="btn" disabled>Play</button>
    <button id="pause" class="btn" disabled>Pause</button>
    <div class="toggles">
      <label>Style
        <select id="style">
          <option value="bars" selected>2D Bars</option>
          <option value="mountain">2D Mountain</option>
          <option value="spikes">2D Spikes</option>
          <option value="circles">2D Circles</option>
          <option value="waveform">2D Waveform</option>
          <option value="radial">2D Radial</option>
          <option value="circular">2D Circular Waveform</option>
          <option value="particles">2D Particles</option>
          <option value="spectrogram">2D Spectrogram</option>
          <option value="3d-bars">3D Bars</option>
          <option value="3d-sphere">3D Sphere</option>
          <option value="3d-tunnel">3D Tunnel</option>
          <option value="3d-waves">3D Waves</option>
          <option value="3d-cube">3D Cube Matrix</option>
          <option value="3d-spiral">3D Spiral</option>
          <option value="3d-galaxy">3D Galaxy</option>
          <option value="3d-dna">3D DNA Helix</option>
        </select>
      </label>
      <label id="bar-style-container" style="display: none;">Bar Style
        <select id="bar-style">
          <option value="led" selected>LED Style</option>
          <option value="gradient">Linear Gradient</option>
          <option value="plain-gradient">Plain Linear Gradient</option>
        </select>
      </label>
      <label>Theme
        <select id="theme">
          <option value="classic" selected>Classic</option>
          <option value="neon">Neon Glow</option>
          <option value="ocean">Ocean Depths</option>
          <option value="fire">Fire Storm</option>
          <option value="matrix">Matrix Code</option>
          <option value="synthwave">Synthwave</option>
          <option value="aurora">Aurora</option>
          <option value="plasma">Plasma</option>
          <option value="rainbow">Rainbow</option>
          <option value="midnight">Midnight</option>
          <option value="custom">Custom Theme</option>
        </select>
      </label>
      <button id="create-theme" class="btn" title="Create Custom Theme">Create Theme</button>
      <button id="screenshot" class="btn" title="Save Screenshot">Screenshot</button>
      <button id="fullscreen" class="btn" title="Toggle Fullscreen">Fullscreen</button>
      <label><input id="effects" type="checkbox" checked> Effects</label>
      <label><input id="grid" type="checkbox" checked> Grid</label>
      <label><input id="bars" type="checkbox" checked> Bars</label>
      <label><input id="peaks" type="checkbox" checked> Peaks</label>
      <label><input id="shake" type="checkbox"> Shake Mode</label>
      <label><input id="flash" type="checkbox"> Beat Flash</label>
      <label><input id="zoom" type="checkbox"> Beat Zoom</label>
      <label><input id="particles-effect" type="checkbox"> Particle Burst</label>
      <label><input id="particle-trails" type="checkbox"> Particle Trails</label>
      <label><input id="particle-fountain" type="checkbox"> Particle Fountain</label>
      <label><input id="fireworks" type="checkbox"> Fireworks</label>
      <label><input id="camera-movement" type="checkbox"> 3D Camera Dance</label>
      <label><input id="low-power" type="checkbox"> Low Power Mode</label>
      <label>Camera Pattern
        <select id="camera-pattern">
          <option value="random" selected>Random</option>
          <option value="orbital">Orbital</option>
          <option value="spiral">Spiral</option>
          <option value="figure8">Figure 8</option>
          <option value="pendulum">Pendulum</option>
        </select>
      </label>
      <label title="Peak hold time">
        Peak Hold
        <input id="peak-seconds" type="range" min="-1" max="15" step="0.1" value="2.5" style="vertical-align: middle; width: 120px;">
        <span id="peak-seconds-val">2.5s</span>
      </label>
      <label title="Peak falling velocity">
        Peak Fall
        <input id="peak-velocity" type="range" min="0.1" max="10" step="0.1" value="1" style="vertical-align: middle; width: 120px;">
        <span id="peak-velocity-val">1.0</span>
      </label>
      <label title="Beat sensitivity">
        Beat Sens
        <input id="beat-sensitivity" type="range" min="0.8" max="1.2" step="0.1" value="1.2" style="vertical-align: middle; width: 120px;">
        <span id="beat-sensitivity-val">1.2</span>
      </label>
      <button id="reset-eq" class="btn" title="Reset EQ to 0 dB">Reset EQ</button>
      <div class="volume-control">
        <span>Vol</span>
        <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="100" title="Volume">
        <span id="volume-value">100%</span>
      </div>
      
      <!-- Advanced Features Controls -->
      <div class="advanced-controls">
        <label><input id="bpm-toggle" type="checkbox" checked> BPM Detection</label>
        <label><input id="spectrum-toggle" type="checkbox"> Spectrum Analysis</label>
        <label><input id="music-theory-toggle" type="checkbox"> Music Theory</label>
        <button id="crossfade-btn" class="btn" title="Crossfade to Next Track">Crossfade</button>
      </div>
    </div>
  </header>
  
  <section class="playlist" aria-label="Enhanced Playlist">
    <div class="playlist-header">
      <h3>Playlist</h3>
      <div class="playlist-controls">
        <button id="shuffle-btn" class="btn" title="Shuffle">Shuffle</button>
        <button id="repeat-btn" class="btn" title="Repeat">Repeat</button>
        <button id="clear-playlist" class="btn" title="Clear Playlist">Clear</button>
        <button id="save-playlist" class="btn" title="Save Playlist">Save</button>
        <button id="load-playlist" class="btn" title="Load Playlist">Load</button>
      </div>
    </div>
    <div class="playlist-list" id="playlist"></div>
  </section>
  
  <main>
    <div id="bg-pattern" class="bg-pattern"></div>
    <canvas id="viz" width="1000" height="420" aria-label="Enhanced Winamp-style spectrum"></canvas>
    <div id="three-container"></div>
  </main>
  
  <section class="eq" aria-label="Equalizer">
    <div class="eq-controls">
      <strong>Equalizer</strong>
      <label><input id="eq-enable" type="checkbox" checked> Enable</label>
    </div>
    <div class="eq-sliders" id="eq-sliders"></div>
  </section>

  <!-- Advanced Features Panels -->
  <section class="advanced-panels">
    <!-- BPM Detection Panel -->
    <div id="bpm-panel" class="bpm-panel">
      <h3>BPM Detection</h3>
      <div class="bpm-display-container">
        <div class="bpm-main">
          <span class="bpm-label">BPM:</span>
          <span id="bpm-display" class="bpm-value">--</span>
        </div>
        <div class="bpm-details">
          <div class="bpm-confidence">
            <span>Confidence: </span>
            <span id="bpm-confidence">--%</span>
          </div>
          <div class="tempo-description">
            <span>Tempo: </span>
            <span id="tempo-description">Unknown</span>
          </div>
        </div>
      </div>
      <div class="bpm-controls">
        <label>Sensitivity:
          <input type="range" id="bpm-sensitivity" min="0.1" max="1.0" step="0.1" value="0.3">
        </label>
      </div>
    </div>

    <!-- Crossfade Panel -->
    <div class="crossfade-panel">
      <h3>Crossfade Control</h3>
      <div class="crossfade-controls">
        <label>Duration:
          <select id="crossfade-duration">
            <option value="1000">1 second</option>
            <option value="2000">2 seconds</option>
            <option value="3000" selected>3 seconds</option>
            <option value="5000">5 seconds</option>
            <option value="8000">8 seconds</option>
          </select>
        </label>
        <label>Curve:
          <select id="crossfade-curve">
            <option value="linear" selected>Linear</option>
            <option value="exponential">Exponential</option>
            <option value="logarithmic">Logarithmic</option>
            <option value="smooth">Smooth</option>
          </select>
        </label>
      </div>
      <div class="crossfade-progress-container">
        <div class="crossfade-progress-bar">
          <div id="crossfade-progress" class="crossfade-progress"></div>
        </div>
      </div>
    </div>

    <!-- Spectrum Analysis Panel -->
    <div id="spectrum-panel" class="spectrum-panel">
      <h3>Spectrum Analysis</h3>
      
      <div class="spectrum-controls">
        <label>Detail Level:
          <select id="spectrum-detail">
            <option value="normal" selected>Normal (30 FPS)</option>
            <option value="high">High (60 FPS)</option>
          </select>
        </label>
      </div>

      <div class="spectrum-info">
        <div class="dominant-frequency">
          <span>Dominant: </span>
          <span id="dominant-frequency">-- Hz</span>
          <span id="musical-note" class="musical-note"></span>
        </div>
      </div>

      <div class="frequency-bands" id="frequency-bands"></div>
      
      <div class="frequency-peaks-container">
        <h4>Frequency Peaks</h4>
        <div id="frequency-peaks" class="frequency-peaks"></div>
      </div>
      
      <div class="spectral-features-container">
        <h4>Spectral Features</h4>
        <div id="spectral-features" class="spectral-features"></div>
      </div>
    </div>

    <!-- Music Theory Analysis Panel -->
    <div id="music-theory-panel" class="music-theory-panel">
      <h3>Music Theory Analysis</h3>
      
      <div class="music-theory-controls">
        <label>Key Confidence:
          <input type="range" id="key-confidence-threshold" min="0.3" max="0.9" step="0.1" value="0.6">
          <span id="key-confidence-value">60%</span>
        </label>
        <label>Chord Confidence:
          <input type="range" id="chord-confidence-threshold" min="0.3" max="0.8" step="0.1" value="0.5">
          <span id="chord-confidence-value">50%</span>
        </label>
      </div>

      <div class="key-analysis">
        <h4>Current Key</h4>
        <div class="key-info">
          <div class="key-display-container">
            <span id="current-key" class="key-display major">C major</span>
            <span id="key-confidence" class="confidence-indicator">--%</span>
          </div>
          <div class="key-signature">
            <span>Key Signature: </span>
            <span id="key-signature">C major / A minor</span>
          </div>
        </div>
      </div>

      <div class="chord-analysis">
        <h4>Current Chord</h4>
        <div class="chord-info">
          <div class="chord-display-container">
            <span id="current-chord" class="chord-display major">C</span>
            <span id="roman-numeral" class="roman-numeral major">I</span>
            <span id="chord-confidence" class="confidence-indicator">--%</span>
          </div>
        </div>
      </div>

      <div class="progression-analysis">
        <h4>Chord Progression</h4>
        <div id="chord-progression" class="chord-progression"></div>
      </div>
    </div>
  </section>
  
  <footer>
    Enhanced 20-band log spectrum with LED segments, peak-hold, classic color ramp. Now with 3D visualizations, beat detection, spectrogram view, enhanced playlist management, mobile support, and performance optimizations!
  </footer>

  <!-- Performance Indicator -->
  <div id="performance-indicator" class="performance-indicator">
    FPS: <span id="fps-counter">60</span> | 
    Memory: <span id="memory-usage">0MB</span>
  </div>

  <!-- Theme Creator Modal -->
  <div id="theme-modal" class="theme-modal">
    <div class="theme-modal-content">
      <div class="theme-modal-header">
        <h2>Create Custom Theme</h2>
        <button id="close-theme-modal" class="close-btn">&times;</button>
      </div>
      <div class="theme-modal-body">
        <div class="theme-section">
          <h3>Theme Name</h3>
          <input type="text" id="theme-name" placeholder="Enter theme name" maxlength="20">
        </div>
        
        <div class="theme-section">
          <h3>Colors</h3>
          <div class="color-grid">
            <label>Primary Color: <input type="color" id="primary-color" value="#9eea6a"></label>
            <label>Background: <input type="color" id="bg-color" value="#000000"></label>
            <label>Border: <input type="color" id="border-color" value="#111111"></label>
            <label>UI Background: <input type="color" id="ui-bg-color" value="#0a0a0a"></label>
          </div>
        </div>
        
        <div class="theme-section">
          <h3>Visualization Colors</h3>
          <div class="color-grid">
            <label>Low Freq: <input type="color" id="low-freq-color" value="#00ff00"></label>
            <label>Mid Freq: <input type="color" id="mid-freq-color" value="#ffff00"></label>
            <label>High Freq: <input type="color" id="high-freq-color" value="#ff0000"></label>
          </div>
        </div>
        
        <div class="theme-section">
          <h3>Effects</h3>
          <div class="effect-grid">
            <label><input type="checkbox" id="glow-effect"> Glow Effect</label>
            <label><input type="checkbox" id="blur-effect"> Blur Effect</label>
            <label><input type="checkbox" id="neon-effect"> Neon Effect</label>
          </div>
        </div>
        
        <div class="theme-preview">
          <h3>Preview</h3>
          <div id="theme-preview-box" class="preview-box">
            <div class="preview-bar" style="height: 60%; background: #00ff00;"></div>
            <div class="preview-bar" style="height: 80%; background: #ffff00;"></div>
            <div class="preview-bar" style="height: 40%; background: #ff0000;"></div>
          </div>
        </div>
      </div>
      
      <div class="theme-modal-footer">
        <button id="export-theme" class="btn">Export Theme</button>
        <button id="import-theme" class="btn">Import Theme</button>
        <button id="save-theme" class="btn">Save Theme</button>
        <button id="cancel-theme" class="btn">Cancel</button>
      </div>
      
      <!-- Hidden file input for theme import -->
      <input type="file" id="theme-file-input" accept=".json" style="display: none;">
    </div>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="script.js"></script>
<script src="modules/audio-manager.js"></script>
<script src="modules/playlist-manager.js"></script>
<script src="modules/performance-manager.js"></script>
<script src="modules/mobile-support.js"></script>
<script src="enhanced_script.js"></script>
</body>
</html>